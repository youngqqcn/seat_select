<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet SVG 与 GeoJSON 交互示例</title>
    <!-- 引入 Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- 引入 Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.2);
            z-index: 400;
            max-width: 300px;
        }
        .info-title {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 8px;
        }
        .interaction-info {
            font-size: 14px;
            color: #666;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info-panel">
        <h3 class="info-title">交互信息</h3>
        <div id="interaction-content" class="interaction-info">
            点击地图上的 SVG 元素或 GeoJSON 特征查看详情
        </div>
    </div>

    <script>
        // 初始化地图
        const map = L.map('map').setView([39.9042, 116.4074], 12); // 北京坐标

        // 添加底图图层
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 示例 GeoJSON 数据 - 北京市部分区域
        const beijingGeoJSON = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "东城区",
                        "description": "北京市的中心城区之一，拥有许多历史文化遗产"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [[116.3705, 39.9426], [116.4163, 39.9426], [116.4163, 39.9107], [116.3705, 39.9107], [116.3705, 39.9426]]
                        ]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "西城区",
                        "description": "北京市的中心城区之一，政治中心功能集中区"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [[116.3412, 39.9563], [116.3705, 39.9563], [116.3705, 39.9107], [116.3412, 39.9107], [116.3412, 39.9563]]
                        ]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "朝阳区",
                        "description": "北京市的重要商业区和外交使馆区"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [[116.4163, 39.9563], [116.4800, 39.9563], [116.4800, 39.9000], [116.4163, 39.9000], [116.4163, 39.9563]]
                        ]
                    }
                }
            ]
        };

        // 定义 GeoJSON 样式
        function style(feature) {
            return {
                fillColor: getColor(feature.properties.name),
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        // 根据区域名称获取颜色
        function getColor(name) {
            switch(name) {
                case '东城区': return '#800026';
                case '西城区': return '#4B0082';
                case '朝阳区': return '#0000CD';
                default: return '#FFD700';
            }
        }

        // 高亮样式
        function highlightFeature(e) {
            const layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.9
            });

            // 在移动设备上禁用双击缩放
            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }

            updateInfo(layer.feature.properties);
        }

        // 重置样式
        function resetHighlight(e) {
            geojson.resetStyle(e.target);
        }

        // 点击跳转
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // 绑定事件
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }

        // 添加 GeoJSON 到地图
        const geojson = L.geoJSON(beijingGeoJSON, {
            style: style,
            onEachFeature: onEachFeature
        }).addTo(map);

        // 更新信息面板
        function updateInfo(props) {
            const infoContent = document.getElementById('interaction-content');
            infoContent.innerHTML = `<strong>${props.name}</strong><br>${props.description}`;
        }

        // 创建 SVG 图标 - 这里使用 Leaflet 的 DivIcon 来嵌入 SVG
        const svgIcon = L.divIcon({
            html: `
                <svg width="30" height="30" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="#FF5733" fill-opacity="0.7"/>
                    <circle cx="50" cy="50" r="25" fill="white"/>
                    <text x="50" y="60" font-family="Arial" font-size="14" text-anchor="middle" fill="#333">POI</text>
                </svg>
            `,
            className: 'custom-svg-icon',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });

        // SVG 标记点数据
        const svgPoints = [
            { latlng: [39.9299, 116.3879], name: "天安门", description: "北京的标志性建筑" },
            { latlng: [39.9119, 116.4074], name: "故宫博物院", description: "中国明清两代的皇家宫殿" },
            { latlng: [39.9975, 116.3376], name: "颐和园", description: "中国清朝时期的皇家园林" }
        ];

        // 创建自定义 SVG 图层组
        const svgLayerGroup = L.layerGroup().addTo(map);

        // 添加 SVG 标记到地图
        svgPoints.forEach(point => {
            const marker = L.marker(point.latlng, { icon: svgIcon }).addTo(svgLayerGroup);

            // 绑定弹出窗口
            marker.bindPopup(`<strong>${point.name}</strong><br>${point.description}`);

            // 鼠标悬停效果
            marker.on('mouseover', function() {
                this.openPopup();
                document.getElementById('interaction-content').innerHTML =
                    `<strong>${point.name}</strong><br>${point.description}`;
            });

            marker.on('click', function() {
                map.setView(point.latlng, 15);
            });
        });

        // 添加图层控制
        const baseMaps = {
            "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            })
        };

        const overlayMaps = {
            "城区区域 (GeoJSON)": geojson,
            "兴趣点 (SVG)": svgLayerGroup
        };

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        // 添加比例尺
        L.control.scale().addTo(map);
    </script>
</body>
</html>